{"version":3,"sources":["tasks/serve.js"],"names":["__decorate","decorators","target","key","desc","c","arguments","length","r","Object","getOwnPropertyDescriptor","d","Reflect","decorate","i","defineProperty","__metadata","k","v","metadata","_","require","development_core_1","browserSync","StartService","info","name","ctx","gulp","option","files","serverFiles","isFunction","dist","getDist","getInfo","baseDir","serverBaseDir","push","browsersyncOption","server","open","port","process","env","PORT","browsersync","extend","tkn","subTaskName","task","callback","err","bs","order","total","test","value","runWay","RunWay","parallel","oper","Operation","default","serve","exports"],"mappings":"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","file":"../../tasks/serve.js","sourcesContent":["\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nconst _ = require('lodash');\nconst development_core_1 = require('development-core');\nconst browserSync = require('browser-sync');\nlet StartService = class StartService {\n    constructor(info) {\n        this.info = info;\n    }\n    getInfo() {\n        this.info.name = this.info.name || 'serve';\n        return this.info;\n    }\n    setup(ctx, gulp) {\n        let option = ctx.option;\n        let files = null;\n        if (option.serverFiles) {\n            files = _.isFunction(option.serverFiles) ? option.serverFiles(ctx) : option.serverFiles;\n        }\n        files = files || [];\n        let dist = ctx.getDist(this.getInfo());\n        let baseDir = null;\n        if (option.serverBaseDir) {\n            baseDir = _.isFunction(option.serverBaseDir) ? option.serverBaseDir(ctx) : option.serverBaseDir;\n        }\n        else {\n            baseDir = dist;\n        }\n        files.push(`${dist}/**/*`);\n        let browsersyncOption = {\n            server: {\n                baseDir: baseDir\n            },\n            open: true,\n            port: process.env.PORT || 3000,\n            files: files\n        };\n        if (option.browsersync) {\n            browsersyncOption = _.extend(browsersyncOption, _.isFunction(option.browsersync) ? option.browsersync(ctx, browsersyncOption) : option.browsersync);\n        }\n        let tkn = ctx.subTaskName(this.info);\n        gulp.task(tkn, (callback) => {\n            browserSync(browsersyncOption, (err, bs) => {\n                if (err) {\n                    callback(err);\n                }\n            });\n        });\n        return tkn;\n    }\n};\nStartService = __decorate([\n    development_core_1.task({\n        order: (total, ctx) => ctx.env.test ? { value: 0.25, runWay: development_core_1.RunWay.parallel } : 1,\n        oper: development_core_1.Operation.default | development_core_1.Operation.serve\n    }), \n    __metadata('design:paramtypes', [Object])\n], StartService);\nexports.StartService = StartService;\n"]}