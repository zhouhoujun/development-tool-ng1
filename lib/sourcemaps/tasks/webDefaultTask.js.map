{"version":3,"sources":["tasks/webDefaultTask.js"],"names":["__decorate","decorators","target","key","desc","d","c","arguments","length","r","Object","getOwnPropertyDescriptor","Reflect","_typeof","decorate","i","defineProperty","__metadata","k","v","metadata","_","chalk","require","development_core_1","karma_1","browserSync","del","Clean","info","_classCallCheck","this","_createClass","value","name","ctx","gulp","tkn","task","getSrc","order","oper","Operation","clean","default","exports","BuildTest","option","subTaskName","getInfo","karmaConfigFile","path","join","env","root","cfg","karmaConfig","Server","extend","basePath","isUndefined","karmaBasePath","getDist","toStr","singleRun","watch","configFile","code","console","log","red","cyan","callback","start","runWay","RunWay","parallel","build","test","DeployTest","isAbsolute","release","StartService","serverFiles","files","dist","baseDir","isFunction","serverBaseDir","browsersyncOption","port","process","PORT","browsersync","err","bs","total","serve"],"mappings":"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","file":"../../tasks/webDefaultTask.js","sourcesContent":["\"use strict\";\nvar __decorate = (this && this.__decorate) || function (decorators, target, key, desc) {\n    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;\n    if (typeof Reflect === \"object\" && typeof Reflect.decorate === \"function\") r = Reflect.decorate(decorators, target, key, desc);\n    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;\n    return c > 3 && r && Object.defineProperty(target, key, r), r;\n};\nvar __metadata = (this && this.__metadata) || function (k, v) {\n    if (typeof Reflect === \"object\" && typeof Reflect.metadata === \"function\") return Reflect.metadata(k, v);\n};\nconst _ = require('lodash');\nconst chalk = require('chalk');\n// import * as path from 'path';\nconst development_core_1 = require('development-core');\n// import * as chalk from 'chalk';\nconst karma_1 = require('karma');\nconst path = require('path');\nconst browserSync = require('browser-sync');\nconst del = require('del');\n// @dynamicTask\n// export class WebDefaultTasks implements IDynamicTasks {\n//     tasks(): IDynamicTaskOption[] {\n//         return [\n//             {\n//                 name: 'clean',\n//                 order: 0,\n//                 oper: Operation.clean | Operation.default,\n//                 task: (ctx, dt) => del(ctx.getSrc(dt))\n//             }\n//         ];\n//     }\n// }\nlet Clean = class Clean {\n    constructor(info) {\n        this.info = info;\n    }\n    getInfo() {\n        this.info.name = this.info.name || 'clean';\n        return this.info;\n    }\n    setup(ctx, gulp) {\n        let info = this.getInfo();\n        let tkn = ctx.subTaskName(info);\n        gulp.task(tkn, () => {\n            return del(ctx.getSrc(info));\n        });\n        return tkn;\n    }\n};\nClean = __decorate([\n    development_core_1.task({\n        order: 0,\n        oper: development_core_1.Operation.clean | development_core_1.Operation.default\n    }), \n    __metadata('design:paramtypes', [Object])\n], Clean);\nexports.Clean = Clean;\nlet BuildTest = class BuildTest {\n    constructor(info) {\n        this.info = info;\n    }\n    getInfo() {\n        this.info.name = this.info.name || 'test';\n        return this.info;\n    }\n    setup(ctx, gulp) {\n        let option = ctx.option;\n        let tkn = ctx.subTaskName(this.getInfo());\n        gulp.task(tkn, (callback) => {\n            let karmaConfigFile = option.karmaConfigFile || path.join(ctx.env.root, './karma.conf.js');\n            if (!path.isAbsolute(karmaConfigFile)) {\n                karmaConfigFile = path.join(ctx.env.root, karmaConfigFile);\n            }\n            let cfg = null;\n            if (option.karmaConfig) {\n                cfg = option.karmaConfig(ctx);\n            }\n            new karma_1.Server(_.extend(cfg || { basePath: _.isUndefined(option.karmaBasePath) ? ctx.getDist() : ctx.toStr(option.karmaBasePath), singleRun: ctx.env.watch !== true }, {\n                configFile: karmaConfigFile,\n            }), (code) => {\n                if (code === 1) {\n                    console.log(chalk.red('Unit Test failures, exiting process'), ', code:', chalk.cyan(code));\n                    callback('Unit Test failures, exiting process');\n                }\n                else {\n                    console.log('Unit Tests passed', ', code:', chalk.cyan(code));\n                    callback();\n                }\n            }).start();\n        });\n        return tkn;\n    }\n};\nBuildTest = __decorate([\n    development_core_1.task({\n        order: { value: 0.25, runWay: development_core_1.RunWay.parallel },\n        oper: development_core_1.Operation.build | development_core_1.Operation.test\n    }), \n    __metadata('design:paramtypes', [Object])\n], BuildTest);\nexports.BuildTest = BuildTest;\nlet DeployTest = class DeployTest {\n    constructor(info) {\n        this.info = info;\n    }\n    getInfo() {\n        this.info.name = this.info.name || 'test';\n        return this.info;\n    }\n    setup(ctx, gulp) {\n        let option = ctx.option;\n        let tkn = ctx.subTaskName(this.getInfo());\n        gulp.task(tkn, (callback) => {\n            let karmaConfigFile = option.karmaConfigFile || path.join(ctx.env.root, './karma.conf.js');\n            if (!path.isAbsolute(karmaConfigFile)) {\n                karmaConfigFile = path.join(ctx.env.root, karmaConfigFile);\n            }\n            let cfg = null;\n            if (option.karmaConfig) {\n                cfg = option.karmaConfig(ctx);\n            }\n            new karma_1.Server(_.extend(cfg || { basePath: ctx.getDist(), singleRun: true }, {\n                configFile: karmaConfigFile\n            }), (code) => {\n                if (code === 1) {\n                    console.log(chalk.red('Unit Test failures, exiting process'), ', code:', chalk.cyan(code));\n                    callback('Unit Test failures, exiting process');\n                }\n                else {\n                    console.log('Unit Tests passed', ', code:', chalk.cyan(code));\n                    callback();\n                }\n            }).start();\n        });\n        return tkn;\n    }\n};\nDeployTest = __decorate([\n    development_core_1.task({\n        order: { value: 0.25, runWay: development_core_1.RunWay.parallel },\n        oper: development_core_1.Operation.deploy | development_core_1.Operation.release | development_core_1.Operation.test\n    }), \n    __metadata('design:paramtypes', [Object])\n], DeployTest);\nexports.DeployTest = DeployTest;\nlet StartService = class StartService {\n    constructor(info) {\n        this.info = info;\n    }\n    getInfo() {\n        this.info.name = this.info.name || 'serve';\n        return this.info;\n    }\n    setup(ctx, gulp) {\n        let option = ctx.option;\n        let files = null;\n        if (option.serverFiles) {\n            files = _.isFunction(option.serverFiles) ? option.serverFiles(ctx) : option.serverFiles;\n        }\n        files = files || [];\n        let dist = ctx.getDist(this.getInfo());\n        let baseDir = null;\n        if (option.serverBaseDir) {\n            baseDir = _.isFunction(option.serverBaseDir) ? option.serverBaseDir(ctx) : option.serverBaseDir;\n        }\n        else {\n            baseDir = dist;\n        }\n        files.push(`${dist}/**/*`);\n        let browsersyncOption = {\n            server: {\n                baseDir: baseDir\n            },\n            open: true,\n            port: process.env.PORT || 3000,\n            files: files\n        };\n        if (option.browsersync) {\n            browsersyncOption = _.extend(browsersyncOption, _.isFunction(option.browsersync) ? option.browsersync(ctx, browsersyncOption) : option.browsersync);\n        }\n        let tkn = ctx.subTaskName(this.info);\n        gulp.task(tkn, (callback) => {\n            browserSync(browsersyncOption, (err, bs) => {\n                if (err) {\n                    callback(err);\n                }\n            });\n        });\n        return tkn;\n    }\n};\nStartService = __decorate([\n    development_core_1.task({\n        order: (total, ctx) => ctx.env.test ? { value: 0.25, runWay: development_core_1.RunWay.parallel } : 1,\n        oper: development_core_1.Operation.default | development_core_1.Operation.serve\n    }), \n    __metadata('design:paramtypes', [Object])\n], StartService);\nexports.StartService = StartService;\n"]}