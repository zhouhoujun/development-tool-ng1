{"version":3,"sources":["index.ts"],"names":[],"mappings":"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","file":"../index.js","sourcesContent":["import * as _ from 'lodash';\r\nimport { ITask, Operation, RunWay, ITaskConfig, taskdefine, IContextDefine, IAssertOption, IEnvOption, ITaskContext } from 'development-core';\r\nimport { Clean } from './tasks/clean';\r\nimport { StartServer } from './tasks/serve';\r\nimport { KarmaTest } from './tasks/test';\r\nimport { IWebTaskOption } from './WebTaskOption';\r\nexport * from './WebTaskOption';\r\n\r\n\r\n@taskdefine()\r\nexport class WebDefine implements IContextDefine {\r\n    loadConfig(option: IAssertOption, env: IEnvOption): ITaskConfig {\r\n        // register default asserts.\r\n        if (_.isUndefined(option.assertsOrder)) {\r\n            option.assertsOrder = 0;\r\n        }\r\n        option.asserts = _.extend({\r\n            css: Operation.default | Operation.autoWatch,\r\n            jpeg: Operation.default | Operation.autoWatch,\r\n            jpg: Operation.default | Operation.autoWatch,\r\n            gif: Operation.default | Operation.autoWatch,\r\n            png: Operation.default | Operation.autoWatch,\r\n            ioc: Operation.default | Operation.autoWatch,\r\n            svg: Operation.default | Operation.autoWatch,\r\n            ttf: Operation.default | Operation.autoWatch,\r\n            woff: Operation.default | Operation.autoWatch,\r\n            eot: Operation.default | Operation.autoWatch,\r\n            ts: 'development-assert-ts',\r\n            js: Operation.default | Operation.autoWatch\r\n        }, option.asserts || {});\r\n\r\n\r\n        return <ITaskConfig>{\r\n            option: option,\r\n            env: env\r\n        };\r\n    }\r\n\r\n    setContext(ctx: ITaskContext) {\r\n        let webOption = ctx.option as IWebTaskOption;\r\n\r\n        if (webOption.forceTest !== false && webOption.test !== false) {\r\n            ctx.add(<ITaskConfig>{\r\n                option: <IWebTaskOption>{\r\n                    name: 'test',\r\n                    karma: webOption.karma,\r\n                    order: webOption.testOrder || (total => { return { value: 2 / total, runWay: RunWay.parallel } }),\r\n                    loader: (ctx) => {\r\n                        return ctx.findTasks(KarmaTest);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n        if (ctx.oper & Operation.serve) {\r\n            ctx.add(<ITaskConfig>{\r\n                option: <IWebTaskOption>{\r\n                    name: 'serve',\r\n                    browsersync: webOption.browsersync,\r\n                    order: (total, ctx) => ctx.env.test ? { value: 2 / total, runWay: RunWay.parallel } : 1,\r\n                    loader: (ctx) => {\r\n                        return ctx.findTasks(StartServer);\r\n                    }\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    tasks(ctx: ITaskContext): Promise<ITask[]> {\r\n        return ctx.findTasks(Clean);\r\n        // let tasks = [\r\n        //     Clean,\r\n        //     StartServer,\r\n        //     KarmaTest\r\n        // ];\r\n        // let option: IWebTaskOption = ctx.option;\r\n        // if (option.forceTest === false || ctx.env.test === false || ctx.env.test === 'false') {\r\n        //     tasks.pop();\r\n        // }\r\n        // return ctx.findTasks(tasks);\r\n        // return ctx.findTasksInDir(path.join(__dirname, './tasks'));\r\n    }\r\n}\r\n"]}