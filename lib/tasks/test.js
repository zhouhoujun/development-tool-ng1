"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,n,a){return n&&e(t.prototype,n),a&&e(t,a),t}}(),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},__decorate=function(e,t,n,a){var r,o=arguments.length,i=o<3?t:null===a?a=Object.getOwnPropertyDescriptor(t,n):a;if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.decorate)i=Reflect.decorate(e,t,n,a);else for(var c=e.length-1;c>=0;c--)(r=e[c])&&(i=(o<3?r(i):o>3?r(t,n,i):r(t,n))||i);return o>3&&i&&Object.defineProperty(t,n,i),i},__metadata=function(e,t){if("object"===("undefined"==typeof Reflect?"undefined":_typeof(Reflect))&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=require("lodash"),chalk=require("chalk"),development_core_1=require("development-core"),karam=require("karma"),path=require("path"),KaramTest=function(){function e(t){_classCallCheck(this,e),this.info=t}return _createClass(e,[{key:"getInfo",value:function(){return this.info.name=this.info.name||"web-test",this.info}},{key:"setup",value:function(e,t){var n=e.option,a=e.subTaskName(this.getInfo());return t.task(a,function(t){var a=n.karmaConfigFile||path.join(e.env.root,"./karma.conf.js");path.isAbsolute(a)||(a=path.join(e.env.root,a));var r=null;n.karmaConfig&&(r=n.karmaConfig(e)),n.karamjspm&&(r.files=r.files||[],r.frameworks),r=_.extend(r||{singleRun:e.env.release||e.env.deploy||e.env.watch!==!0},{configFile:a}),n.karmaBasePath?r.basePath=e.toStr(n.karmaBasePath):_.isUndefined(r.basePath)&&(r.basePath=e.getDist());var o=new karam.Server(r,function(e){1===e?(console.log(chalk.red("Unit Test failures, exiting process"),", code:",chalk.cyan(e)),t("Unit Test failures, exiting process")):(console.log("Unit Tests passed",", code:",chalk.cyan(e)),t())});n.karamjspm&&o.on("file_list_modified",function(){}),o.start()}),a}}]),e}();KaramTest=__decorate([development_core_1.task({order:{value:.25,runWay:development_core_1.RunWay.parallel},oper:development_core_1.Operation.default|development_core_1.Operation.test}),__metadata("design:paramtypes",[Object])],KaramTest),exports.KaramTest=KaramTest;var createPattern=function(e){return{pattern:e,included:!0,served:!0,watched:!1}},createServedPattern=function(e,t){return{pattern:e,included:!!(t&&"included"in t)&&t.included,served:!(t&&"served"in t)||t.served,nocache:!!(t&&"nocache"in t)&&t.nocache,watched:!(t&&"watched"in t)||t.watched}};
//# sourceMappingURL=../sourcemaps/tasks/test.js.map
