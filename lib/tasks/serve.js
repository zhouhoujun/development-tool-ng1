"use strict";var __decorate=this&&this.__decorate||function(e,t,r,o){var a,i=arguments.length,n=i<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,r):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)n=Reflect.decorate(e,t,r,o);else for(var s=e.length-1;s>=0;s--)(a=e[s])&&(n=(i<3?a(n):i>3?a(t,r,n):a(t,r))||n);return i>3&&n&&Object.defineProperty(t,r,n),n},__metadata=this&&this.__metadata||function(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)},_=require("lodash"),development_core_1=require("development-core"),browserSync=require("browser-sync"),path=require("path"),StartServer=function(){function e(e){this.info=e}return e.prototype.getInfo=function(){return this.info.name=this.info.name||"web-serve",this.info},e.prototype.setup=function(e,t){var r=e.option.browsersync||{},o=r.watchOptions||{ignoreInitial:!0,ignored:["*.txt","*.map","*.d.ts"]},a=[];if(r.files){var i=e.to(r.files);a=_.isArray(i)?i:[i]}if(r.filesByCtx){var n=e.to(r.filesByCtx);_.isArray(n)?a=a.concat(n):a.push(n)}var s=e.getPackage(),p=e.getRootPath(),c="";c=r.jspm&&r.jspm.packages?e.toRootPath(e.toStr(r.jspm.packages)):s.jspm&&s.jspm&&s.jspm.directories?e.toRootPath(s.jspm.directories.packages):e.toRootPath("./node_modules");var f=!1,u=path.basename(c);o.ignored=_.isArray(o.ignored)?o.ignored:[o.ignored],o.ignored.push(u+"/**");var l=new RegExp("/^"+u+"//","gi");a=_.map(a||[],function(e){return _.isString(e)?(f||(f=l.test(e)),{match:e,options:o}):e}),!f&&c&&a.push({match:path.relative(p,c)+"/**",options:o});var h=e.getDist(this.getInfo()),d=null;d=r.baseDir?e.toRootSrc(_.isFunction(r.baseDir)?r.baseDir(e):r.baseDir):h,d=_.isArray(d)?d:[d],d.push(path.dirname(c));var m=path.relative(_.first(d),c);/^\.\./.test(m)&&d.push(p),d=_.uniq(_.map(d,function(e){return path.isAbsolute(e)?path.relative(p,e)||".":e})),a.push({match:path.relative(p,h)+"/**",options:o});var v=_.extend({open:!0,port:process.env.PORT||3e3},_.omit(r,["files","baseDir","jspm"]),{watchOptions:o,server:{baseDir:d},files:a}),g=e.subTaskName(this.info);return t.task(g,function(e){browserSync(v,function(t,r){t&&e(t)})}),g},e}();StartServer=__decorate([development_core_1.task({order:function(e,t){return t.env.test?{value:2/e,runWay:development_core_1.RunWay.parallel}:1},oper:development_core_1.Operation.default|development_core_1.Operation.serve}),__metadata("design:paramtypes",[Object])],StartServer),exports.StartServer=StartServer;
//# sourceMappingURL=../sourcemaps/tasks/serve.js.map
